<!DOCTYPE html>
<html>
<link rel="stylesheet" href="style.css">
<style type="text/css">
  body {
    font-family: sans-serif;
    text-align: center;
  }

  button {
    padding: 10px 20px;
    font-size: 16px;
    border-radius: 5px;
    background-color: #4c5baf;
    color: white;
    cursor: pointer;
  }

  button:hover {
    background-color: #3e468e;
  }
</style>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.2.7-rc.0/web3.min.js"></script>

<head>
  <title>Lottery Website</title>
</head>

<body>
  <h1>Welcome to the lottery website!</h1>
  <p>Connect your Metamask wallet by clicking the button below:</p>
  <button onclick="connectMetamask()" id="smth">Connect Metamask</button>
  <p>Connect to the Smart Contract by clicking the button below:</p>
  <button onclick="connectContract()" id="connect-contract">Connect smart contract</button>
  <p>Enter the lottery by clicking the button below:</p>
  <button onclick="enter()" id="enter-lottery-button">Enter Lottery</button>
  <p>To pick a winner, click the button below:</p>
  <button onclick="pickWinner()" id="pick-winner-button">Pick Winner <span id="winner"></span> </button>
  <p>Number of people entered: <span id="entered-count">0</span></p>

  <script src="script.js"></script>
  <script>
    let account;
    const connectMetamask = async () => {
      if (window.ethereum !== "undefined") {
        const accounts = await ethereum.request({ method: "eth_requestAccounts" });
        account = accounts[0];
        document.getElementById("smth").innerHTML = account;
      }
    }

    const connectContract = async () => {
      const ABI = [
        {
          "inputs": [],
          "name": "enter",
          "outputs": [],
          "stateMutability": "payable",
          "type": "function"
        },
        {
          "inputs": [],
          "name": "pickWinner",
          "outputs": [],
          "stateMutability": "nonpayable",
          "type": "function"
        },
        {
          "inputs": [],
          "stateMutability": "nonpayable",
          "type": "constructor"
        },
        {
          "inputs": [],
          "name": "getBalance",
          "outputs": [
            {
              "internalType": "uint256",
              "name": "",
              "type": "uint256"
            }
          ],
          "stateMutability": "view",
          "type": "function"
        },
        {
          "inputs": [],
          "name": "getPlayers",
          "outputs": [
            {
              "internalType": "address payable[]",
              "name": "",
              "type": "address[]"
            }
          ],
          "stateMutability": "view",
          "type": "function"
        },
        {
          "inputs": [],
          "name": "getRandomNumber",
          "outputs": [
            {
              "internalType": "uint8",
              "name": "",
              "type": "uint8"
            }
          ],
          "stateMutability": "view",
          "type": "function"
        },
        {
          "inputs": [],
          "name": "owner",
          "outputs": [
            {
              "internalType": "address",
              "name": "",
              "type": "address"
            }
          ],
          "stateMutability": "view",
          "type": "function"
        },
        {
          "inputs": [
            {
              "internalType": "uint256",
              "name": "",
              "type": "uint256"
            }
          ],
          "name": "players",
          "outputs": [
            {
              "internalType": "address payable",
              "name": "",
              "type": "address"
            }
          ],
          "stateMutability": "view",
          "type": "function"
        },
        {
          "inputs": [],
          "name": "winner",
          "outputs": [
            {
              "internalType": "address",
              "name": "",
              "type": "address"
            }
          ],
          "stateMutability": "view",
          "type": "function"
        }
      ]
      const Address = "0x85aB2A51943B72407AD9021064a7D3Bd27ecF5cD";
      window.web3 = await new Web3(window.ethereum);
      window.contract = await new window.web3.eth.Contract(ABI, Address);
      document.getElementById("connect-contract").innerHTML = "connected to smart contract";
    }

    const enter = async () => {
      try {
        await window.contract.methods.enter().send({
          from: account,
          value: '1000000000000000000',
          gas: 3000000,
        });
        const response = await window.contract.methods.getBalance().call();
        document.getElementById("entered-count").innerHTML = response / 1000000000000000000;
      }
      catch (error) {
        console.log("ERROR ENTERING", error);
      }
    }

    const pickWinner = async () => {
      try {
        await window.contract.methods.pickWinner().send()({
          from: account,
        });
        const win = await window.contract.methods.winner().call();
        document.getElementById("winner").innerHTML = win;
      } catch (error) {
        console.log("ERROR GETTING PLAYER COUNT")
      }
    }

  </script>
</body>

</html>